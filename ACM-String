/************   ACAM (AC自动机)    **********/
HDU2222:查找有几个模式串在文本串中出现过
	#include<bits/stdc++.h>
	using namespace std;
	#define maxn 500005  
	int n,T;  
	char s[maxn<<1];   								
    int ch[maxn][26],fail[maxn],val[maxn],last[maxn]; 
    int times[10005],cnt[10005]; // 每个单词出现次数   
    int tot,num;                //单词总数以及单词出现了几个  
    void init()  
    {  
        num=0;  tot=1;  
        memset(ch[0],0,sizeof(ch[0]));  
        memset(cnt,0,sizeof(cnt));  
        memset(times,0,sizeof(times));  
    }     
	int idx(char c){ return c - 'a';}  
    void insert(char*s,int v) //插入
    {  
        int u=0,n=strlen(s);  
        for(int i=0;i<n;++i)  
        {  
            int c=idx(s[i]);  
            if(!ch[u][c])  
            {  
                memset(ch[tot],0,sizeof(ch[tot]));  
                val[tot]=0;  
                ch[u][c]=tot++;   
            }  
            u=ch[u][c];  
        }  
        if(val[u]) times[val[u]]++;//重复的模式串  
        else  val[u]=v,times[v]=1;  
    }
	void getFail()  
    {  
        queue<int> q;  
        fail[0]=0;  
        for(int c=0;c<26;++c)  
        {  
            int u=ch[0][c];  
            if(u){ fail[u]=0;q.push(u);last[u]=0; }  
        }  
        while(!q.empty())  
        {  
            int r=q.front(); q.pop();  
            for(int c=0;c<26;++c)  
            {  								
                int u=ch[r][c];  
                if(!u){ch[r][c]=ch[fail[r]][c];continue;}  
                q.push(u);  
                int v=fail[r];  
                fail[u]=ch[v][c];  
                last[u] = val[fail[u]]?fail[u]:last[fail[u]];  
            }  
        }  
    }   
    void print(int i,int j)                   
    {  
        if(j)   
        {  
            if(!cnt[val[j]])  num+=times[val[j]];  
            cnt[val[j]]++; //每个模式串出现的次数 
            print(i,last[j]);  
        }  
    }  
    void find(char *T)  
    {  
        int n=strlen(T);  
        int j=0;  
        for(int i=0;i<n;++i)  
        {  
            int c=idx(T[i]);  
          	j=ch[j][c];  
            if(val[j]) print(i,j);  
            else if(last[j]) print(i,last[j]);  
        }  
    }    
	int main()  
	{  
	    cin>>T;
	    while(T--)  
	    {  
	        init(); cin>>n;  
	        for(int i=1;i<=n;i++)  
	        {  
	            scanf("%s",s);  
	            insert(s,i);  
	        }  
	        getFail();  
	        scanf("%s",s);  
	        find(s);  
	        cout<<num<<endl;  
	    }
		return 0;  
	}   

edit by songhailei
